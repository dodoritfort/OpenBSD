<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="generator" content="Jekyll v3.3.1">

		<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Open+Sans:400,400italic,600,600italic,700,700italic|Inconsolata:400,700">
		<link rel="stylesheet" href="/css/main.css">
		<link rel="apple-touch-icon" href="/apple-touch-icon.png">
		<link rel="icon" type="image/png" href="/touch-icon.png" sizes="192x192">
		<link rel="icon" type="image/png" href="/images/favicon.png">

		<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="OpenBSD" />
		<!-- Begin Jekyll SEO tag v2.0.0 -->
<title>Search - OpenBSD</title>
<meta property="og:title" content="Search" />
<meta name="description" content="Product documentation template for Jekyll." />
<meta property="og:description" content="Product documentation template for Jekyll." />
<link rel="canonical" href="http://localhost:4000/search/" />
<meta property="og:url" content="http://localhost:4000/search/" />
<meta property="og:site_name" content="OpenBSD" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "WebPage",
    "headline": "Search",
    "description": "Product documentation template for Jekyll.",
    "logo": "http://localhost:4000/siteicon.png",
    "url": "http://localhost:4000/search/"
  }
</script>
<!-- End Jekyll SEO tag -->

		
	</head>

	<body>
		<header>
			<h1>
				<a href="/"><img src="/images/emblem.svg" width="40" height="40" alt="OpenBSD logo"></a>
				OpenBSD
				<button type="button" class="open-nav" id="open-nav"></button>
			</h1>

			<form action="/search/" method="get">
				<input type="text" name="q" id="search-input" placeholder="Search" autofocus>
				<input type="submit" value="Search" style="display: none;">
			</form>

			<nav class="full-navigation">
				<ul>
					<li class="nav-item top-level ">
						
						<a href="/">Bienvenue</a>
					</li>
				</ul>

				<ul>
					
					
						<li class="nav-item top-level ">
							
							<a href="/maintenance/monter_les_partitions_openbsd_sous_freebsd11-0_rescue/">Maintenance</a>
							<ul>
								
									<li class="nav-item "><a href="/maintenance/monter_les_partitions_openbsd_sous_freebsd11-0_rescue/">Monter les partitions OpenBSD sous FreeBSD11.0-Rescue</a></li>
								
									<li class="nav-item "><a href="/maintenance/installer_les_headers_X_manquants/">Installer les headers X manquants</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/messagerie/installer_le_serveur_de_messagerie_instantanee_prosody_xmpp/">Messagerie</a>
							<ul>
								
									<li class="nav-item "><a href="/messagerie/installer_le_serveur_de_messagerie_instantanee_prosody_xmpp/">Installer le serveur de messagerie Prosody (XMPP)</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/reseau/creer_son_propre_serveur_dns_avec_unbound/">Réseau</a>
							<ul>
								
									<li class="nav-item "><a href="/reseau/creer_son_propre_serveur_dns_avec_unbound/">Créer son propre serveur DNS avec Unbound</a></li>
								
									<li class="nav-item "><a href="/reseau/creer_un_serveur_vpn_avec_openvpn/">Créer un serveur VPN avec OpenVPN</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/systeme/installer_openbsd_6-0_sur_votre_serveur_kimsufi/">Système</a>
							<ul>
								
									<li class="nav-item "><a href="/systeme/installer_openbsd_6-0_sur_votre_serveur_kimsufi/">Installer OpenBSD sur votre serveur Kimsufi</a></li>
								
									<li class="nav-item "><a href="/systeme/installer_et_configurer_nano/">Installer et configurer Nano</a></li>
								
									<li class="nav-item "><a href="/systeme/configurer_ssh/">Configurer SSH</a></li>
								
									<li class="nav-item "><a href="/systeme/configurer_doas/">Configurer DOAS</a></li>
								
									<li class="nav-item "><a href="/systeme/configuration_minimale_de_packetfilter/">Configuration minimale de PacketFilter</a></li>
								
									<li class="nav-item "><a href="/systeme/afficher_ou_changer_le_hostname/">Afficher / Changer le hostname</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/torrent/installer_et_configurer_transmission/">Torrent</a>
							<ul>
								
									<li class="nav-item "><a href="/torrent/installer_et_configurer_transmission/">Installer et configurer Transmission</a></li>
								
							</ul>
						</li>
					
						<li class="nav-item top-level ">
							
							<a href="/web/installer_et_configurer_un_serveur_http_ssl_et_php/">Web</a>
							<ul>
								
									<li class="nav-item "><a href="/web/installer_et_configurer_un_serveur_http_ssl_et_php/">Installer et configurer un serveur HTTP + SSL et PHP</a></li>
								
									<li class="nav-item "><a href="/web/creer_une_base_de_donnees_sql_avec_mariadb/">Créer une base de données SQL avec MariaDB</a></li>
								
									<li class="nav-item "><a href="/web/installer_nextcloud_11/">Installer NextCloud 11</a></li>
								
									<li class="nav-item "><a href="/web/utiliser_relayd_en_tant_que_reverse_proxy/">Utiliser relayd en tant que Reverse Proxy</a></li>
								
							</ul>
						</li>
					
				</ul>

				<ul>
					<li class="nav-item top-level ">
						
						<a href="/changelog/">Change Log</a>
					</li>
				</ul>
			</nav>
		</header>

		<section class="main">
			<div class="page-header">
				<h2>OpenBSD</h2>
				<h3>Search</h3>
			</div>
			<article class="content">
				<p><span id="search-process">Loading</span> results <span id="search-query-container" style="display: none;">for "<strong id="search-query"></strong>"</span></p>
<ul id="search-results"></ul>

<script>
	window.data = {
		
			
				
					
					

					"maintenance-installer-les-headers-x-manquants": {
						"id": "maintenance-installer-les-headers-x-manquants",
						"title": "Installer les headers X manquants",
						"category": "",
						"url": " /maintenance/installer_les_headers_X_manquants/",
						"content": "Il faut effectuer ces manipulations en root. Nous téléchargeons les fichiers nécessaires. wget http: ftp.belnet.be pub OpenBSD 6.0 amd64 xbase60.tgz # wget http: ftp.belnet.be pub OpenBSD 6.0 amd64 xbase60.tgz --2017-03-26 19:50:08-- http: ftp.belnet.be pub OpenBSD 6.0 amd64 xbase60.tgz Resolving ftp.belnet.be (ftp.belnet.be)... 193.190.67.98, 2001:6a8:3c80:2::21 Connecting to ftp.belnet.be (ftp.belnet.be)|193.190.67.98|:80... connected. HTTP request sent, awaiting response... 200 OK Length: 23522236 (22M) [application x-gzip] Saving to: 'xbase60.tgz' xbase60.tgz 100%[=============================================&gt;] 22.43M 9.31MB s in 2.4s 2017-03-26 19:50:10 (9.31 MB s) - 'xbase60.tgz' saved [23522236 23522236] wget http: ftp.belnet.be pub OpenBSD 6.0 amd64 xshare60.tgz # wget http: ftp.belnet.be pub OpenBSD 6.0 amd64 xshare60.tgz --2017-03-26 19:50:13-- http: ftp.belnet.be pub OpenBSD 6.0 amd64 xshare60.tgz Resolving ftp.belnet.be (ftp.belnet.be)... 193.190.67.98, 2001:6a8:3c80:2::21 Connecting to ftp.belnet.be (ftp.belnet.be)|193.190.67.98|:80... connected. HTTP request sent, awaiting response... 200 OK Length: 4507096 (4.3M) [application x-gzip] Saving to: 'xshare60.tgz' xshare60.tgz 100%[=============================================&gt;] 4.30M 7.86MB s in 0.5s 2017-03-26 19:50:13 (7.86 MB s) - 'xshare60.tgz' saved [4507096 4507096] Puis on extrait… tar -C -xzphf xbase60.tgz tar -C -xzphf xshare60.tgz Et enfin, on supprime les fichiers téléchargés et inutiles à présent. rm xbase60.tgz xshare60.tgz"
					}

					
				
			
		
			
				
					,
					

					"maintenance-monter-les-partitions-openbsd-sous-freebsd11-0-rescue": {
						"id": "maintenance-monter-les-partitions-openbsd-sous-freebsd11-0-rescue",
						"title": "Monter les partitions OpenBSD sous FreeBSD11.0-Rescue",
						"category": "",
						"url": " /maintenance/monter_les_partitions_openbsd_sous_freebsd11-0_rescue/",
						"content": "Nous devons commencer par récupérer le nom de notre disque-dur. ls dev ada* root@rescue-bsd:~ # ls dev ada* dev ada0 dev ada0s4 Il s’agit donc de ada0s4. Nous modifions le type de filesystem. fsck -t ffs dev ada0s4 root@rescue-bsd:~ # fsck -t ffs dev ada0s4 ** dev ada0s4 ** Last Mounted on ** Phase 1 - Check Blocks and Sizes ** Phase 2 - Check Pathnames ** Phase 3 - Check Connectivity ** Phase 4 - Check Reference Counts ** Phase 5 - Check Cyl groups SUMMARY INFORMATION BAD SALVAGE? [yn] y 1789 files, 32005 used, 482434 free (66 frags, 60296 blocks, 0.0% fragmentation) ***** FILE SYSTEM MARKED CLEAN ***** ***** FILE SYSTEM WAS MODIFIED ***** Puis nous n’avons plus qu’à monter notre disque comme si de rien n’était. mount dev ada0s4 mnt Et on vérifie que tout a bien fonctionné. ls -l mnt root@rescue-bsd:~ # ls -l mnt total 38818 -rw-r--r-- 1 root wheel 578 Jul 26 2016 .cshrc -rw-r--r-- 1 root wheel 468 Jul 26 2016 .profile drwxr-xr-x 2 root wheel 512 Jul 26 2016 altroot drwxr-xr-x 2 root wheel 1024 Jul 26 2016 bin -rw-r--r-- 1 root wheel 70980 Mar 26 08:54 boot -rw-r--r-- 1 root wheel 10554411 Mar 26 08:58 bsd -rw-r--r-- 1 root wheel 10554411 Mar 26 08:42 bsd.mp -rw-r--r-- 1 root wheel 7905392 Mar 26 08:42 bsd.rd -rw-r--r-- 1 root wheel 10504752 Mar 26 08:42 bsd.sp drwxr-xr-x 3 root wheel 19456 Mar 26 19:57 dev drwxr-xr-x 26 root wheel 2048 Apr 4 18:08 etc drwxr-xr-x 2 root wheel 512 Mar 26 08:38 home drwxr-xr-x 2 root wheel 512 Jul 26 2016 mnt drwx------ 2 root wheel 512 Mar 26 19:51 root drwxr-xr-x 2 root wheel 1536 Jul 26 2016 sbin lrwxr-xr-x 1 root wheel 11 Jul 26 2016 sys -&gt; usr src sys drwxr-xr-x 2 root wheel 512 Mar 26 08:38 tmp drwxr-xr-x 2 root wheel 512 Mar 26 08:38 usr drwxr-xr-x 2 root wheel 512 Mar 26 08:38 var Bingo ! Documentation : http: wiki.euserv.com index.php Manual_FreeBSD_Rescue_System en"
					}

					
				
			
		
			
				
					,
					

					"messagerie-installer-le-serveur-de-messagerie-instantanee-prosody-xmpp": {
						"id": "messagerie-installer-le-serveur-de-messagerie-instantanee-prosody-xmpp",
						"title": "Installer le serveur de messagerie Prosody (XMPP)",
						"category": "",
						"url": " /messagerie/installer_le_serveur_de_messagerie_instantanee_prosody_xmpp/",
						"content": "Installer le serveur de messagerie Prosody (XMPP) Prosody est un serveur de messagerie instantanée XMPP écrit en LUA. Ses objectifs sont d’être simple à configurer, d’être modulaire et de consommer peu de ressource système. Installation Rien de plus simple pour l’installer ! Il suffit d’exécuter la commande suivante. pkg_add -i prosody # pkg_add -i prosody quirks-2.241 signed on 2016-07-26T16:56:10Z prosody-0.9.10p2:libidn-1.32p1: ok prosody-0.9.10p2:lua-5.1.5p6: ok prosody-0.9.10p2:luafs-1.6.3p0: ok prosody-0.9.10p2:luadbi-0.5p0: ok prosody-0.9.10p2:luazlib-20100731p2: ok prosody-0.9.10p2:luasocket-3.0rc1p1: ok prosody-0.9.10p2:luasec-0.6p0: ok prosody-0.9.10p2:luaexpat-1.3.0p0: ok prosody-0.9.10p2: ok The following new rcscripts were installed: etc rc.d prosody See rcctl(8) for details. Look in usr local share doc pkg-readmes for extra documentation. Configuration minimale Une fois l’installation effectuée, il faut éditer le fichier de configuration prosody.cfg.lua. A savoir que le double-tiret -- sert à commenter les lignes. nano etc prosody prosody.cfg.lua -- VirtualHost \"localhost\" VirtualHost \"votredomaine.fr\" Documentation : https: prosody.im doc configure Premier démarrage Après avoir configuré notre domaine, nous pouvons dès à présent démarrer notre serveur prosody. rcctl start prosody Nous vérifions ensuite que le service est bien démarré. prosodyctl status # prosodyctl status Prosody is running with PID 99255 Pour qu’il soit exécuté à chaque démarrage, nous devons l’activer. rcctl enable prosody Documentation : https: prosody.im doc prosodyctl Ajouter un utilisateur Par défaut, l’option de création de compte via un client XMPP est désactivée. Il s’agit de la ligne allow_registration = false; du fichier de configuration. Nous devons donc le créer manuellement via la commande suivante où votredomaine.fr est celui que nous avons spécifié dans le VirtualHost du fichier de configuration. prosodyctl adduser user@votredomaine.fr Nous pouvons ensuite nous connecter avec le client XMPP de notre choix et vérifier le fichier log. cat var prosody prosody.log # cat var prosody prosody.log Mar 25 11:48:13 general info Hello and welcome to Prosody version 0.9.10 Mar 25 11:48:13 general info Prosody is using the select backend for connection handling Mar 25 11:48:13 portmanager info Activated service 'c2s' on [::]:5222, [*]:5222 Mar 25 11:48:13 portmanager info Activated service 'legacy_ssl' on no ports Mar 25 11:48:13 portmanager info Activated service 's2s' on [::]:5269, [*]:5269 Mar 25 11:48:13 mod_posix info Prosody is about to detach from the console, disabling further console output Mar 25 11:48:13 mod_posix info Successfully daemonized to PID 5826 Mar 25 11:49:16 c2s107ce75ddf80 info Client connected Mar 25 11:49:20 c2s107ce75ddf80 info Authenticated as user@votredomaine.fr Mar 25 11:49:37 c2s107ce75ddf80 info Client disconnected: closed Pour changer le mot de passe d’un utilisateur. prosodyctl passwd user@votredomaine.fr Pour supprimer un utilisateur. prosodyctl deluser user@votredomaine.fr Documentation : http: prosody.im doc creating_accounts Configurer le mode SSL Commençons par générer le certificat. prosodyctl cert generate votredomaine.fr # prosodyctl cert generate votredomaine.fr Choose key size (2048): 2048 Generating RSA private key, 2048 bit long modulus ...............................................+++ ...........................+++ e is 65537 (0x10001) Key written to var prosody votredomaine.fr.key Please provide details to include in the certificate config file. Leave the field empty to use the default value or '.' to exclude the field. countryName (GB): FR localityName (The Internet): organizationName (Your Organisation): organizationalUnitName (XMPP Department): commonName (votredomaine.fr): emailAddress (xmpp@votredomaine.fr): Config written to var prosody votredomaine.fr.cnf Certificate written to var prosody votredomaine.fr.crt Puis spécifions cela dans le fichier de configuration. nano etc prosody prosody.cfg.lua -- These are the SSL TLS-related settings. If you don't want -- to use SSL TLS, you may comment or remove this ssl = { key = \" var prosody votredomaine.fr.key\"; certificate = \" var prosody votredomaine.fr.crt\"; } Ensuite on recharge la configuration et on redémarre le serveur. prosodyctl reload # prosodyctl reload Prosody log files re-opened and config file reloaded. You may need to reload modules for some changes to take effect. prosodyctl restart # prosodyctl restart Stopped Started Documentation : https: prosody.im doc certificates"
					}

					
				
			
		
			
				
					,
					

					"reseau-creer-son-propre-serveur-dns-avec-unbound": {
						"id": "reseau-creer-son-propre-serveur-dns-avec-unbound",
						"title": "Créer son propre serveur DNS avec Unbound",
						"category": "",
						"url": " /reseau/creer_son_propre_serveur_dns_avec_unbound/",
						"content": "ftp -o var unbound etc root.hints ftp: FTP.INTERNIC.NET domain named.cache nano etc monthly.local # Télécharge la liste des DNS Root pour Unbound ftp -o var unbound etc root.hints ftp: FTP.INTERNIC.NET domain named.cache unbound-anchor -u _unbound -a “ var unbound db root.key” Vérifier le nombre de coeurs du CPU utilisé. sysctl hw.ncpu sysctl hw.ncpufound # sysctl hw.ncpu hw.ncpu=4 # sysctl hw.ncpufound hw.ncpufound=4 Nous pourrons donc spécifier dans le fichier de configuration que notre processeur est composé de 4 coeurs. nano var unbound etc unbound.conf # $OpenBSD: unbound.conf,v 1.7 2016 03 30 01:41:25 sthen Exp $ server: # Nombre de coeurs sur le CPU # number of threads to create. 1 disables threading. This should equal the number # of CPU cores in the machine. Our example machine has 4 CPU cores. num-threads: 4 # Cache size key-cache-size: 512m # Increase the memory size of the cache. Use roughly twice as much rrset cache # memory as you use msg cache memory. Due to malloc overhead, the total memory # usage is likely to rise to double (or 2.5x) the total cache memory. The test # box has 4gig of ram so 256meg for rrset allows a lot of room for cacheed objects. rrset-cache-size: 256m msg-cache-size: 128m outgoing-range: 206 # port to answer queries from port: 53 # specify the interfaces to answer queries from by ip-address. The default # is to listen to localhost (127.0.0.1 and ::1). specify 0.0.0.0 and ::0 to # bind to all available interfaces. specify every interface[@port] on a new # 'interface:' labeled line. The listen interfaces are not changed on # reload, only on restart. interface: 127.0.0.1 #interface: 127.0.0.1@5353 # listen on alternative port interface: ::1 # Enable IPv4, \"yes\" or \"no\". do-ip4: yes # Enable IPv6, \"yes\" or \"no\". do-ip6: yes # Enable UDP, \"yes\" or \"no\". do-udp: yes # Enable TCP, \"yes\" or \"no\". If TCP is not needed, Unbound is actually # quicker to resolve as the functions related to TCP checks are not done.i # NOTE: you may need tcp enabled to get the DNSSEC results from *.edu domains # due to their size. do-tcp: yes # override the default \"any\" address to send queries; if multiple # addresses are available, they are used randomly to counter spoofing #outgoing-interface: 192.0.2.1 #outgoing-interface: 2001:db8::53 access-control: 0.0.0.0 0 refuse access-control: 127.0.0.0 8 allow access-control: ::0 0 refuse access-control: ::1 allow # Fichier à récupérer sur ftp: FTP.INTERNIC.NET domain named.cache # Read the root hints from this file. Default is nothing, using built in # hints for the IN class. The file has the format of zone files, with root # nameserver names and addresses only. The default may become outdated, # when servers change, therefore it is good practice to use a root-hints # file. get one from ftp: FTP.INTERNIC.NET domain named.cache root-hints: \" var unbound etc root.hints\" harden-below-nxdomain: yes # Require DNSSEC data for trust-anchored zones, if such data is absent, the # zone becomes bogus. Harden against receiving dnssec-stripped data. If you # turn it off, failing to validate dnskey data for a trustanchor will trigger # insecure mode for that zone (like without a trustanchor). Default on, # which insists on dnssec data for trust-anchored zones. harden-dnssec-stripped: yes harden-referral-path: yes # Will trust glue only if it is within the servers authority. # Harden against out of zone rrsets, to avoid spoofing attempts. # Hardening queries multiple name servers for the same data to make # spoofing significantly harder and does not mandate dnssec. harden-glue: yes # Enable to not answer id.server and hostname.bind queries. hide-identity: yes # Enable to not answer version.server and version.bind queries. hide-version: yes # Use 0x20-encoded random bits in the query to foil spoof attempts. # http: tools.ietf.org html draft-vixie-dnsext-dns0x20-00 # While upper and lower case letters are allowed in domain names, no significance # is attached to the case. That is, two names with the same spelling but # different case are to be treated as if identical. This means calomel.org is the # same as CaLoMeL.Org which is the same as CALOMEL.ORG. use-caps-for-id: yes # Enforce privacy of these addresses. Strips them away from answers. It may # cause DNSSEC validation to additionally mark it as bogus. Protects against # 'DNS Rebinding' (uses browser as network proxy). Only 'private-domain' and # 'local-data' names are allowed to have these private addresses. No default. private-address: 192.168.0.0 16 private-address: 172.16.0.0 12 private-address: 10.0.0.0 8 # Allow queries to nsd on 127.0.0.1 # IMPORTANT FOR TESTING: If you are testing and setup NSD or BIND on # localhost you will want to allow the resolver to send queries to localhost. # Make sure to set do-not-query-localhost: yes . If yes, the above default # do-not-query-address entries are present. if no, localhost can be queried # (for testing and debugging). do-not-query-localhost: no # Should additional section of secure message also be kept clean of unsecure # data. Useful to shield the users of this validator from potential bogus # data in the additional section. All unsigned data in the additional section # is removed from secure messages. val-clean-additional: yes # Uncomment to enable qname minimisation. # https: tools.ietf.org html draft-ietf-dnsop-qname-minimisation-08 # qname-minimisation: yes # Uncomment to enable DNSSEC validation. # auto-trust-anchor-file: \" var unbound db root.key\" # Garde les résultats en cache # perform prefetching of close to expired message cache entries. If a client # requests the dns lookup and the TTL of the cached hostname is going to # expire in less than 10% of its TTL, unbound will (1st) return the ip of the # host to the client and (2nd) pre-fetch the dns request from the remote dns # server. This method has been shown to increase the amount of cached hits by # local clients by 10% on average. prefetch: yes # the time to live (TTL) value lower bound, in seconds. Default 0. # If more than an hour could easily give trouble due to stale data. cache-min-ttl: 3600 # the time to live (TTL) value cap for RRsets and messages in the # cache. Items are not cached for longer. In seconds. cache-max-ttl: 86400 # Serve zones authoritatively from Unbound to resolver clients. # Not for external service. # #local-zone: \"local.\" static #local-data: \"mycomputer.local. IN A 192.0.2.51\" #local-zone: \"2.0.192.in-addr.arpa.\" static #local-data-ptr: \"192.0.2.51 mycomputer.local\" # UDP EDNS reassembly buffer advertised to peers. Default 4096. # May need lowering on broken networks with fragmentation MTU issues, # particularly if validating DNSSEC. # #edns-buffer-size: 1480 # Use TCP for \"forward-zone\" requests. Useful if you are making # DNS requests over an SSH port forwarding. # #tcp-upstream: yes # DNS64 options, synthesizes AAAA records for hosts that don't have # them. For use with NAT64 (PF \"af-to\"). # #module-config: \"dns64 validator iterator\" #dns64-prefix: 64:ff9b:: 96 # well-known prefix (default) #dns64-synthall: no # the number of slabs to use for cache and must be a power of 2 times the # number of num-threads set above. more slabs reduce lock contention, but # fragment memory usage. msg-cache-slabs: 8 rrset-cache-slabs: 8 infra-cache-slabs: 8 key-cache-slabs: 8 # buffer size for UDP port 53 incoming (SO_RCVBUF socket option). This sets # the kernel buffer larger so that no messages are lost in spikes in the traffic. # so-rcvbuf: 1m # Gestion des journaux unwanted-reply-threshold: 10000 logfile: var unbound etc unbound.log val-log-level: 2 verbosity: 1 remote-control: control-enable: yes control-use-cert: no control-interface: var run unbound.sock # Use an upstream forwarder (recursive resolver) for specific zones. # Example addresses given below are public resolvers valid as of 2014 03. # #forward-zone: # name: \".\" # use for ALL queries # forward-addr: 74.82.42.42 # he.net # forward-addr: 2001:470:20::2 # he.net v6 # forward-addr: 8.8.8.8 # google.com # forward-addr: 2001:4860:4860::8888 # google.com v6 # forward-addr: 208.67.222.222 # opendns.com # forward-first: yes # try direct if forwarder fails # nano etc weekly.local # Permet de faire la vérification DNSSEC unbound-anchor -a \" var unbound db root.key\" sh etc weekly.local rcctl enable unbound rcctl start unbound nano etc resolv.conf nameserver 127.0.0.1 Documentation : http: man.openbsd.org unbound.conf Documentation : https: www.unbound.net documentation unbound.conf.html Documentation : http: obsd4a.net wiki doku.php?id=network:config:unbound_dnssec Documentation : https: calomel.org unbound_dns.html Documentation : https: homeserver-diy.net wiki index.php?title=Installer_et_configurer_son_serveur_DNS_connect%C3%A9_aux_serveurs_root_avec_Unbound"
					}

					
				
			
		
			
				
					,
					

					"reseau-creer-un-serveur-vpn-avec-openvpn": {
						"id": "reseau-creer-un-serveur-vpn-avec-openvpn",
						"title": "Créer un serveur VPN avec OpenVPN",
						"category": "",
						"url": " /reseau/creer_un_serveur_vpn_avec_openvpn/",
						"content": "pkg_add -i openvpn openvpn_bsdauth easy-rsa # pkg_add -i openvpn openvpn_bsdauth easy-rsa quirks-2.241 signed on 2016-07-26T16:56:10Z openvpn-2.3.11:lzo2-2.09: ok openvpn-2.3.11: ok openvpn_bsdauth-7p0: ok easy-rsa-3.0.1:openssl-1.0.2h: ok easy-rsa-3.0.1: ok Look in usr local share doc pkg-readmes for extra documentation. --- +openssl-1.0.2h ------------------- You may wish to add usr local lib eopenssl man to etc man.conf install -m 700 -d etc openvpn private install -m 755 -d etc openvpn certs install -m 755 -d var log openvpn mkdir -p tmp openvpn cd tmp openvpn cp -r usr local share easy-rsa * . cp vars.example vars nano vars set_var EASYRSA_REQ_COUNTRY \"FR\" set_var EASYRSA_REQ_PROVINCE \"France\" set_var EASYRSA_REQ_CITY \"Roubaix\" set_var EASYRSA_REQ_ORG \"votredomaine.fr\" set_var EASYRSA_REQ_EMAIL \"openvpn@votredomaine.fr\" set_var EASYRSA_REQ_OU \"votredomaine.fr\" set_var EASYRSA_KEY_SIZE 4096 . easyrsa init-pki # . easyrsa init-pki Note: using Easy-RSA configuration from: . vars init-pki complete; you may now create a CA or requests. Your newly created PKI dir is: tmp openvpn pki . easyrsa build-ca nopass # . easyrsa build-ca nopass Note: using Easy-RSA configuration from: . vars Generating a 4096 bit RSA private key ................................++ ........................++ writing new private key to ' tmp openvpn pki private ca.key.vzoRmOw16U' ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter '.', the field will be left blank. ----- Common Name (eg: your user, host, or server name) [Easy-RSA CA]: CA creation complete and you may now import and sign cert requests. Your new CA certificate file for publishing is at: tmp openvpn pki ca.crt . easyrsa build-server-full server nopass # . easyrsa build-server-full server nopass Note: using Easy-RSA configuration from: . vars Generating a 4096 bit RSA private key ................................................................++ ........................................................................................................................++ writing new private key to ' tmp openvpn pki private server.key.ZwVuZpJIRM' ----- Using configuration from tmp openvpn openssl-1.0.cnf Check that the request matches the signature Signature ok The Subject's Distinguished Name is as follows commonName :ASN.1 12:'server' Certificate is to be certified until Apr 3 17:01:11 2027 GMT (3650 days) Write out database with 1 new entries Data Base Updated . easyrsa gen-dh # . easyrsa gen-dh Note: using Easy-RSA configuration from: . vars Generating DH parameters, 4096 bit long safe prime, generator 2 This is going to take a long time ...............................+............. ............................................. ...........+................................ DH parameters of size 4096 created at tmp openvpn pki dh.pem . easyrsa gen-crl # . easyrsa gen-crl Note: using Easy-RSA configuration from: . vars Using configuration from tmp openvpn openssl-1.0.cnf An updated CRL has been created. CRL file: tmp openvpn pki crl.pem chown -R _openvpn:wheel pki * chmod -R 600 pki * cd etc openvpn cp -p tmp openvpn pki ca.crt certs ca.crt cp -p tmp openvpn pki issued server.crt certs server.crt cp -p tmp openvpn pki private server.key private server.key cp -p tmp openvpn pki dh.pem dh.pem cp -p tmp openvpn pki crl.pem crl.pem rm -rf tmp openvpn nano etc openvpn private mgmt.pwd &gt; chown root:wheel etc openvpn private mgmt.pwd &gt; chmod 600 etc openvpn private mgmt.pwd &gt; nano etc openvpn server.conf configuration reseau dev tun0 server 10.8.0.0 255.255.255.0 push “redirect-gateway def1” On propose le resolveur de FDN https: www.fdn.fr actions dns push “dhcp-option DNS 80.67.169.12” Si le serveur a son propre resolveur push “dhcp-option DNS 10.8.0.1” les certificats ca etc openvpn certs ca.crt cert etc openvpn certs server.crt key etc openvpn private server.key dh etc openvpn dh.pem crl-verify etc openvpn crl.pem options diverses comp-lzo daemon openvpn float group _openvpn user _openvpn ifconfig-pool-persist var openvpn ipp.txt keepalive 10 120 management 127.0.0.1 1195 etc openvpn private mgmt.pwd max-clients 100 persist-key persist-tun port 1194 proto udp authentification client-cert-not-required username-as-common-name script-security 3 system auth-user-pass-verify usr local libexec openvpn_bsdauth via-env auth-nocache journaux log-append var log openvpn openvpn.log status var log openvpn openvpn-status.log verb 3 &gt; chown root:_openvpn etc openvpn server.conf &gt; chmod 640 etc openvpn server.conf &gt; nano etc pf.conf tun_if = “tun0” pass out on $ext_if from 10.8.0.0 24 to any nat-to ($ext_if) pass in quick on $tun_if keep state &gt; pfctl -d &gt; pfctl -ef etc pf.conf &gt; nano etc sysctl.conf net.inet.ip.forwarding=1 &gt; sysctl net.inet.ip.forwarding=1 &gt; useradd -G _openvpnusers utilisateur &gt; passwd utilisateur &gt; nano etc hostname.tun0 up ! usr local sbin openvpn –config etc openvpn server.conf &gt; sh etc netstart &gt; tail -f var log openvpn * &gt; kill -9 $(pgrep openvpn) &gt; cat etc openvpn certs ca.crt —–BEGIN CERTIFICATE—– MIIDQTCCAimgAwIBAgIJAOwa Yq2rNGJMA0GCSqGSIb3DQEBCwUAMBoxGDAWBgNV ………. OxjoYBwhWgWq avx6qprB HklcI6O7tjApGgbgSZNcTNrqu17xUftCxKthgqQfzt TTzpUC8e3es1Dvrq+pYs4wYY3mqp —–END CERTIFICATE—– Côté client (Windows 7), télécharger et installer OpenVPN sur le site officiel : [https: openvpn.net index.php open-source downloads.html](https: openvpn.net index.php open-source downloads.html) Créer un dossier et créer dedans un fichier `votredomaine.fr.ovpn` avec le contenu suivant. client dev tun0 proto udp remote 5.39.83.4 1194 ca [inline] auth-user-pass comp-lzo auth-nocache -----BEGIN CERTIFICATE----- MIIDQTCCAimgAwIBAgIJAOwa Yq2rNGJMA0GCSqGSIb3DQEBCwUAMBoxGDAWBgNV .......... OxjoYBwhWgWq avx6qprB HklcI6O7tjApGgbgSZNcTNrqu17xUftCxKthgqQfzt TTzpUC8e3es1Dvrq+pYs4wYY3mqp -----END CERTIFICATE----- auth-user-pass user-pass.txt Dans ce même dossier, créer un second fichier nommé `user-pass.txt` contenant le compte utilisateur créé ci-dessus. monuservpn monpasswordvpn ``` Importer ensuite la configuration dans OpenVPN GUI."
					}

					
				
			
		
			
				
					,
					

					"systeme-afficher-ou-changer-le-hostname": {
						"id": "systeme-afficher-ou-changer-le-hostname",
						"title": "Afficher / Changer le hostname",
						"category": "",
						"url": " /systeme/afficher_ou_changer_le_hostname/",
						"content": "Introduction Le hostname (nom d’hôte) est le nom donné à une machine. Configuration Pour afficher le nom d’hôte, exécuter la commande suivante. cat etc myname Pour changer le hostname, il suffit d’éditer le fichier etc myname où exemple est le nom de la machine et votredomaine.fr le nom de domaine dont elle fait partie. nano etc myname exemple.votredomaine.fr Pour que les modifications soient prises en compte il faut redémarrer la machine où exécuter la commande suivante. sh etc netstart"
					}

					
				
			
		
			
				
					,
					

					"systeme-configuration-minimale-de-packetfilter": {
						"id": "systeme-configuration-minimale-de-packetfilter",
						"title": "Configuration minimale de PacketFilter",
						"category": "",
						"url": " /systeme/configuration_minimale_de_packetfilter/",
						"content": "nano etc pf.conf # $OpenBSD: pf.conf,v 1.54 2014 08 23 05:49:42 deraadt Exp $ # # See pf.conf(5) and etc examples pf.conf ########### # MACRO # ########### ext_if = \"em0\" # Interface port_ssh = \"22\" # Port SSH set skip on lo # Pas de filtre en local set limit table-entries 400000 # Nombre d entree maximale dans une table ###################### # TABLES Blacklist # ###################### table &lt;ssh_abuse&gt; persist ##################################################### # Protection contre l'usurpation de l'adresse IP # ##################################################### block in quick from urpf-failed antispoof for $ext_if block return # block stateless traffic pass # establish keep-state # By default, do not permit remote connections to X11 block return in on ! lo0 proto tcp to port 6000:6010 ########################### # SSH - Anti BruteForce # ########################### block in log quick proto tcp from &lt;ssh_abuse&gt; to any port $port_ssh pass in on $ext_if proto tcp to any port $port_ssh flags S SA keep state \\ (max-src-conn 3, max-src-conn-rate 3 60, overload &lt;ssh_abuse&gt; flush global) Activer PacketFilter pfctl -e Désactiver PacketFilter pfctl -d Vérifier la configuration sans l’injecter pfctl -nf etc pf.conf Recharger la configuration à chaud pfctl -f etc pf.conf Voir les règles chargées pfctl -s rules Afficher les flux en temps réel tcpdump -n -e -ttt -i pflog0 Afficher les logs tcpdump -n -e -ttt -r var log pflog Afficher les IP de la blackliste pfctl -t ssh_abuse -T show Pour supprimer une adresse IP de la blackliste pfctl -t ssh_abuse -T delete xxx.xxx.xxx.xxx Vider les règles du pare feu pfctl -F all Voir les connexions en cours pfctl -s states Documentation : http: man.openbsd.org pf.conf"
					}

					
				
			
		
			
				
					,
					

					"systeme-configurer-doas": {
						"id": "systeme-configurer-doas",
						"title": "Configurer DOAS",
						"category": "",
						"url": " /systeme/configurer_doas/",
						"content": "Créer le fichier de configuration doas.conf. nano etc doas.conf Et y entrer la configuration suivante. permit keepenv { PKG_PATH ENV PS1 SSH_AUTH_SOCK } :wheel Se déconnecter de la session root pour revenir à un utilisateur standard. Puis vérifier que cela fonctionne en tapant par exemple la commande de mise à jour des paquets. Normalement, le système demandera le mot de passe root. doas pkg_add -uvi # doas pkg_add -uvi doas: keepenv with list is obsolete doas (root@openbsd) password: Update candidates: quirks-2.241 -&gt; quirks-2.241 quirks-2.241 signed on 2016-07-26T16:56:10Z Update candidates: gettext-0.19.7 -&gt; gettext-0.19.7 Update candidates: libiconv-1.14p3 -&gt; libiconv-1.14p3 Update candidates: libidn-1.32p1 -&gt; libidn-1.32p1 Update candidates: lua-5.1.5p6 -&gt; lua-5.1.5p6 Update candidates: luadbi-0.5p0 -&gt; luadbi-0.5p0 Update candidates: luaexpat-1.3.0p0 -&gt; luaexpat-1.3.0p0 Update candidates: luafs-1.6.3p0 -&gt; luafs-1.6.3p0 Update candidates: luasec-0.6p0 -&gt; luasec-0.6p0 Update candidates: luasocket-3.0rc1p1 -&gt; luasocket-3.0rc1p1 Update candidates: luazlib-20100731p2 -&gt; luazlib-20100731p2 Update candidates: nano-2.6.0 -&gt; nano-2.6.0 Update candidates: prosody-0.9.10p2 -&gt; prosody-0.9.10p2"
					}

					
				
			
		
			
				
					,
					

					"systeme-configurer-ssh": {
						"id": "systeme-configurer-ssh",
						"title": "Configurer SSH",
						"category": "",
						"url": " /systeme/configurer_ssh/",
						"content": "nano etc ssh sshd_config Changer le port de SSH Port 222. Interdire la connexion SSH en root PermitRootLogin no. Autoriser 6 tentatives de connexions maximum MaxAuthTries 6. Limiter à 10 le nombre de session MaxSessions 10. Puis recharger la configuration. rcctl reload sshd Et bien entendu, nous devons nous déconnecter et reconnecter (sur le port 222 à présent)."
					}

					
				
			
		
			
				
					,
					

					"systeme-installer-et-configurer-nano": {
						"id": "systeme-installer-et-configurer-nano",
						"title": "Installer et configurer Nano",
						"category": "",
						"url": " /systeme/installer_et_configurer_nano/",
						"content": "Tout d’abords, installons Nano. pkg_add nano Nous cherchons ensuite où est caché Nano. find -name “nano” # find -name \"nano\" usr local bin nano usr local share doc nano usr local share examples nano usr local share nano Puis copions un exemple de fichier de configure dans le répertoire home de l’utilisateur souhaité. cp usr local share examples nano nanorc.sample ~ .nanorc Et enfin nous éditions ce fameux fichier de configuration. nano ~ .nanorc Dans ce fichier, nous pouvons par exemple activer les choses suivantes. Activer l’auto-indentation avec set autoindent. ## Use auto-indentation. set autoindent Activer la souris en mode console dans Nano (si disponible par l’OS) avec set mouse. ## Enable mouse support, if available for your system. When enabled, ## mouse clicks can be used to place the cursor, set the mark (with a ## double click), and execute shortcuts. The mouse will work in the X ## Window System, and on the console when gpm is running. set mouse Puis on active la coloration syntaxique avec include \" usr local share nano *.nanorc\". Cette option est géniale car elle permet d’inclure toutes les colorations en une seule fois. ## to set the background color to black or white. ## ## All regexes should be extended regular expressions. ## ## If you wish, you may put your syntax definitions in separate files. ## You can make use of such files as follows: ## ## include \" path to syntax_file.nanorc\" ## ## Unless otherwise noted, the name of the syntax file (without the ## \".nanorc\" extension) should be the same as the \"short description\" ## name inside that file. These names are kept fairly short to make ## them easier to remember and faster to type using nano's -Y option. ## ## To include all existing syntax definitions, you can do: include \" usr local share nano *.nanorc\" Et on enregistre avec la combinaison de touche CTRL + X et on répond Y. Pour afficher le nombre de ligne dans Nano, on utilise la commande suivante nano -c. nano -c ~ .nanorc"
					}

					
				
			
		
			
				
					,
					

					"systeme-installer-openbsd-6-0-sur-votre-serveur-kimsufi": {
						"id": "systeme-installer-openbsd-6-0-sur-votre-serveur-kimsufi",
						"title": "Installer OpenBSD sur votre serveur Kimsufi",
						"category": "",
						"url": " /systeme/installer_openbsd_6-0_sur_votre_serveur_kimsufi/",
						"content": "Installer le système d’exploitation et obtenir des informations Une fois notre serveur Kimsufi en poche, nous devons commencer par installer un système d’exploitation. Nous choisirons donc d’installer Debian 7.10 (Wheezy) (oldstable) 64 bits. Une fois l’installation terminée, nous recevons un mail avec les identifiants de connexion SSH. Nous nous connectons ensuite à notre serveur en SSH à l’aide du logiciel PuTTY. login as: root root@5.39.xx.xx's password: Debian GNU Linux 7.11 Linux ns30xxxxx.ip-5-39-xx.eu 3.14.32-xxxx-grs-ipv6-64 #9 SMP Thu Oct 20 14:53:52 CEST 2016 x86_64 GNU Linux server : 27xxxx hostname : ns30xxxxx.ip-5-39-xx.eu eth0 IPv4 : 5.39.xx.xx eth0 IPv6 : 2001:41d0:x:xxxx::1 128 Last login: Thu Mar 16 16:16:21 2017 from cache-ng.ovh.net Nous récupérons les informations concernant le processeur, l’objectif étant de vérifier si notre serveur utilise un processeur mono ou double coeurs. dmesg grep -i ^cpu root@ns30xxxxx:~# dmesg | grep -i ^cpu CPU: Physical Processor ID: 0 CPU: Processor Core ID: 0 CPU0: Thermal monitoring enabled (TM2) cpuidle: using governor ladder cpuidle: using governor menu Ensuite, récupérons les informations concernant l’adressage réseau. ifconfig root@ns30xxxxx:~# ifconfig eth0 Link encap:Ethernet HWaddr 00:22:4d:a1:c9:47 inet addr:5.39.xx.xx Bcast:5.39.83.255 Mask:255.255.255.0 inet6 addr: 2001:41d0:x:xxxx::1 128 Scope:Global inet6 addr: fe80::222:xxxx:xxxx:xxxx 64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:51277 errors:0 dropped:0 overruns:0 frame:0 TX packets:27385 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:69740971 (66.5 MiB) TX bytes:2887482 (2.7 MiB) Interrupt:16 Memory:80400000-80420000 lo Link encap:Local Loopback inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1 128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:465 errors:0 dropped:0 overruns:0 frame:0 TX packets:465 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:54882 (53.5 KiB) TX bytes:54882 (53.5 KiB) Et enfin les nameserver. cat etc resolv.conf root@ns30xxxxx:~# cat etc resolv.conf nameserver 127.0.0.1 nameserver 213.186.33.99 search ovh.net Préparation de l’installation Après quoi nous devons nous rendre sur notre interface client Kimsufi et paramétrer notre serveur pour qu’il démarre en mode rescue. Pour cela il suffit de cliquer sur le bouton Netboot, puis sur ‘Rescue’ et enfin de sélectionner ‘rescue64-pro’. Valider en cliquant sur le bouton Suivant. Pour finir, nous cliquons sur le bouton Redémarrer pour faire un redémarrage à froid. L’opération prend quelques secondes minutes. Lorsque le serveur a démarré en mode rescue, nous recevons à nouveau un mail avec les identifiants de connexion SSH. Nous les utilisons pour nous connecter à nouveau à notre serveur. login as: root root@5.39.xx.xx's password: The programs included with the Debian GNU Linux system are free software; the exact distribution terms for each program are described in the individual files in usr share doc * copyright. Debian GNU Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. root@rescue:~# Nous allons créer un dossier tmp et télécharger l’image miniroot60.fs sur le site officiel de l’éditeur. wget -P tmp http: ftp.fr.openbsd.org pub OpenBSD 6.0 amd64 miniroot60.fs root@rescue:~# wget -P tmp http: ftp.fr.openbsd.org pub OpenBSD 6.0 amd64 miniroot60.fs --2017-03-16 17:21:30-- http: ftp.fr.openbsd.org pub OpenBSD 6.0 amd64 miniroot60.fs Resolving ftp.fr.openbsd.org (ftp.fr.openbsd.org)... 145.238.209.46 Connecting to ftp.fr.openbsd.org (ftp.fr.openbsd.org)|145.238.209.46|:80... conn ected. HTTP request sent, awaiting response... 200 OK Length: 4063232 (3.9M) [application octet-stream] Saving to: ‘ tmp miniroot60.fs’ tmp miniroot60.fs 100%[=====================&gt;] 3.88M 10.1MB s in 0.4s 2017-03-16 17:21:30 (10.1 MB s) - ‘ tmp miniroot60.fs’ saved [4063232 4063232] Ensuite nous téléchargeons la signature SHA256. wget -P tmp http: ftp.fr.openbsd.org pub OpenBSD 6.0 amd64 SHA256 root@rescue:~# wget -P tmp http: ftp.fr.openbsd.org pub OpenBSD 6.0 amd64 SHA256 --2017-03-16 17:21:53-- http: ftp.fr.openbsd.org pub OpenBSD 6.0 amd64 SHA256 Resolving ftp.fr.openbsd.org (ftp.fr.openbsd.org)... 145.238.209.46 Connecting to ftp.fr.openbsd.org (ftp.fr.openbsd.org)|145.238.209.46|:80... connected. HTTP request sent, awaiting response... 200 OK Length: 1989 (1.9K) [application octet-stream] Saving to: ‘ tmp SHA256’ tmp SHA256 100%[=====================&gt;] 1.94K --.-KB s in 0.03s 2017-03-16 17:21:53 (59.5 KB s) - ‘ tmp SHA256’ saved [1989 1989] Puis on compare la signature de l’archive et celle téléchargée. Si les deux sont identiques, c’est tout bon ! sha256sum tmp miniroot60.fs; grep miniroot60.fs tmp SHA256 cut -d ‘ ‘ -f 4 root@rescue:~# sha256sum tmp miniroot60.fs; grep miniroot60.fs tmp SHA256 | cut -d ' ' -f 4 a6ff63e72ed9f45a211b0a57fb566e6f674242988e369209cd6b2a205d8bcec1 tmp miniroot6 0.fs a6ff63e72ed9f45a211b0a57fb566e6f674242988e369209cd6b2a205d8bcec1 Nous nous rendons dans le dossier tmp. cd tmp root@rescue:~# cd tmp Nous lançons une machine virtuelle à l’aide de QEmu. qemu-system-x86_64 -curses -drive file=miniroot60.fs -drive file= dev sda -net nic -net user root@rescue: tmp# qemu-system-x86_64 -curses -drive file=miniroot60.fs -drive file= dev sda -net nic -net user Parfait ! L’installation de OpenBSD commence… Installation de OpenBSD Welcome to the OpenBSD amd64 6.0 installation program. (I)nstall, (U)pgrade, (A)utoinstall or (S)hell? i At any prompt except password prompts you can escape to a shell by typing '!'. Default answers are shown in []'s and are selected by pressing RETURN. You can exit this program at any time by pressing Control-C, but this can leave your system in an inconsistent state. Ici nous choisissons le keyboard que nous souhaitons. L us Choose your keyboard layout ('?' or 'L' for list) [default] L Available layouts: be br cf de dk es fr hu is it jp la lt lv nl no pl pt ru sf s g si sv tr ua uk us Choose your keyboard layout ('?' or 'L' for list) [default] us kbd: keyboard mapping set to us Nous définissons ensuite le nom d’hôte. System hostname? (short form, e.g. 'foo') hostname Puis nous configurons le réseau en DHCP. em0 dhcp none done Available network interfaces are: em0 vlan0. Which network interface do you wish to configure? (or 'done') [em0] IPv4 address for em0? (or 'dhcp' or 'none') [dhcp] DHCPDISCOVER on em0 - interval 1 DHCPOFFER from 10.0.2.2 (52:55:0a:00:02:02) DHCPREQUEST on em0 to 255.255.255.255 DHCPACK from 10.0.2.2 (52:55:0a:00:02:02) bound to 10.0.2.15 -- renewal in 43200 seconds. IPv6 address for em0? (or 'rtsol' or 'none') [none] Available network interfaces are: em0 vlan0. Which network interface do you wish to configure? (or 'done') [done] Using DNS domainname my.domain Using DNS nameservers at 10.0.2.3 Spécification du mot de passe root. Idéalement, un minimum de 12 caractères avec des chiffres et des lettres puis au moins un caractère spécial. Password for root account? (will not echo) Password for root account? (again) Nous devons bien entendu démarrer le service sshd par défaut. Sinon il ne nous sera pas possible de nous connecter à notre serveur. Nous n’avons pas l’utilité du service X Window System du fait que le serveur sera uniquement piloté par le mode console. En revanche, pour les personnes souhaitant avoir un remote desktop, il faudra activer cette option. Cependant pas de panique, il sera toujours possible de le faire à posteriori. yes no no Start sshd(8) by default? [yes] Do you expect to run the X Window System? [yes] no Change the default console to com0? [no] Etape importante ! Il faut configurer un utilisateur, celui-ci servira à se connecter à distance à notre serveur. Pour des raisons de sécurité il n’est pas conseillé de permettre à l’utilisateur root de se connecter en SSH. Si tel était le cas, les attaquants pourraient simplement faire du bruteforce via ce compte. Setup a user? (enter a lower-case loginname, or 'no') [no] username Full name for user username? [username] Password for user username? (will not echo) Password for user username? (again) Comme dit plus haut, nous ne souhaitons pas que l’utilisateur root puisse se connecter en SSH. Beaucoup trop dangereux. no WARNING: root is targeted by password guessing attacks, pubkeys are safer. Allow root ssh login? (yes, no, prohibit-password) [no] Enfin, la configuration de la timezone. Europe Paris What timezone are you in? ('?' for list) [Europe Paris] A présent, il est temps de configurer le partitionnement sur le disque-dur. Nous allons donc lister les disque-durs du serveur et choisir celui de notre choix. Dans notre exemple, il s’agira de wd1. Ensuite, nous utiliserons le (W)hole disk et nous ferons un (A)uto layout. L’opération prend un certain temps… ? wd1 w a done Available disks are: wd0 wd1. Which disk is the root disk? ('?' for details) [wd0] ? wd0: QEMU HARDDISK (0.0G) wd1: QEMU HARDDISK (465.8G) Available disks are: wd0 wd1. Which disk is the root disk? ('?' for details) [wd0] wd1 No valid MBR or GPT. Use (W)hole disk MBR, whole disk (G)PT or (E)dit? [whole] w Setting OpenBSD MBR partition to whole wd1...done. The auto-allocated layout for wd1 is: # size offset fstype [fsize bsize cpg] a: 1024.0M 64 4.2BSD 2048 16384 1 # b: 223.8M 2097216 swap c: 476940.0M 0 unused d: 4096.0M 2555456 4.2BSD 2048 16384 1 # tmp e: 4319.8M 10944064 4.2BSD 2048 16384 1 # var f: 2048.0M 19790912 4.2BSD 2048 16384 1 # usr g: 1024.0M 23985216 4.2BSD 2048 16384 1 # usr X11R6 h: 10240.0M 26082368 4.2BSD 2048 16384 1 # usr local i: 2048.0M 47053888 4.2BSD 2048 16384 1 # usr src j: 2048.0M 51248192 4.2BSD 2048 16384 1 # usr obj k: 307200.0M 55442496 4.2BSD 4096 32768 1 # home Use (A)uto layout, (E)dit auto layout, or create (C)ustom layout? [a] a dev rwd1a: 1024.0MB in 2097152 sectors of 512 bytes 6 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each dev rwd1k: 307200.0MB in 629145600 sectors of 512 bytes 378 cylinder groups of 814.44MB, 26062 blocks, 52224 inodes each newfs: warning: fsck_ffs will need 112MB; min(ulimit -dH,physmem) is 111MB dev rwd1d: 4096.0MB in 8388608 sectors of 512 bytes 21 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each dev rwd1f: 2048.0MB in 4194304 sectors of 512 bytes 11 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each dev rwd1g: 1024.0MB in 2097152 sectors of 512 bytes 6 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each dev rwd1h: 10240.0MB in 20971520 sectors of 512 bytes 51 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each dev rwd1j: 2048.0MB in 4194304 sectors of 512 bytes 11 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each dev rwd1i: 2048.0MB in 4194304 sectors of 512 bytes 11 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each dev rwd1e: 4319.8MB in 8846848 sectors of 512 bytes 22 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each Which disk do you wish to initialize? (or 'done') [done] dev wd1a (3a4cf22a9ab83757.a) on mnt type ffs (rw, asynchronous, local) dev wd1k (3a4cf22a9ab83757.k) on mnt home type ffs (rw, asynchronous, local, n odev, nosuid) dev wd1d (3a4cf22a9ab83757.d) on mnt tmp type ffs (rw, asynchronous, local, no dev, nosuid) dev wd1f (3a4cf22a9ab83757.f) on mnt usr type ffs (rw, asynchronous, local, no dev) dev wd1g (3a4cf22a9ab83757.g) on mnt usr X11R6 type ffs (rw, asynchronous, loc al, nodev) dev wd1h (3a4cf22a9ab83757.h) on mnt usr local type ffs (rw, asynchronous, loc al, nodev) dev wd1j (3a4cf22a9ab83757.j) on mnt usr obj type ffs (rw, asynchronous, local , nodev, nosuid) dev wd1i (3a4cf22a9ab83757.i) on mnt usr src type ffs (rw, asynchronous, local , nodev, nosuid) dev wd1e (3a4cf22a9ab83757.e) on mnt var type ffs (rw, asynchronous, local, no dev, nosuid) dev) dev wd1g (3a4cf22a9ab83757.g) on mnt usr X11R6 type ffs (rw, asynchronous, loc al, nodev) dev wd1h (3a4cf22a9ab83757.h) on mnt usr local type ffs (rw, asynchronous, loc al, nodev) dev wd1j (3a4cf22a9ab83757.j) on mnt usr obj type ffs (rw, asynchronous, local , nodev, nosuid) dev wd1i (3a4cf22a9ab83757.i) on mnt usr src type ffs (rw, asynchronous, local , nodev, nosuid) dev wd1e (3a4cf22a9ab83757.e) on mnt var type ffs (rw, asynchronous, local, no dev, nosuid) Il nous faut configurer les sets. Les choix par défaut sont très bien. http none ftp.fr.openbsd.org pub OpenBSD 6.0 amd64 Let's install the sets! Location of sets? (cd0 disk http or 'done') [http] HTTP proxy URL? (e.g. 'http: proxy:8080', or 'none') [none] HTTP Server? (hostname, list#, 'done' or '?') [ftp.fr.openbsd.org] Server directory? [pub OpenBSD 6.0 amd64] Ici, nous désactivons certains sets. Mais surtout, nous activons le set bsd.mp. Celui-ci est nécessaire pour l’utilisation d’un processeur multi-coeurs. -g* -x* bsd.mp done done Select sets by entering a set name, a file name pattern or 'all'. De-select sets by prepending a '-' to the set name, file name pattern or 'all'. Selected sets are labelled '[X]'. [X] bsd [X] base60.tgz [X] game60.tgz [X] xfont60.tgz [X] bsd.rd [X] comp60.tgz [X] xbase60.tgz [X] xserv60.tgz [ ] bsd.mp [X] man60.tgz [X] xshare60.tgz Set name(s)? (or 'abort' or 'done') [done] -g* -x* [X] bsd [X] base60.tgz [ ] game60.tgz [ ] xfont60.tgz [X] bsd.rd [X] comp60.tgz [ ] xbase60.tgz [ ] xserv60.tgz [ ] bsd.mp [X] man60.tgz [ ] xshare60.tgz Set name(s)? (or 'abort' or 'done') [done] bsd.mp [X] bsd [X] base60.tgz [ ] game60.tgz [ ] xfont60.tgz [X] bsd.rd [X] comp60.tgz [ ] xbase60.tgz [ ] xserv60.tgz [X] bsd.mp [X] man60.tgz [ ] xshare60.tgz Set name(s)? (or 'abort' or 'done') [done] Get Verify SHA256.sig 100% |**************************| 2152 00:00 Signature Verified Get Verify bsd 100% |**************************| 10258 KB 00:10 Get Verify bsd.rd 100% |**************************| 7720 KB 00:08 Get Verify bsd.mp 100% |**************************| 10307 KB 00:11 Get Verify base60.tgz 100% |**************************| 54422 KB 00:57 Get Verify comp60.tgz 100% |**************************| 49910 KB 00:53 Get Verify man60.tgz 100% |**************************| 8617 KB 00:09 Installing bsd 100% |**************************| 10258 KB 00:01 Installing bsd.rd 100% |**************************| 7720 KB 00:00 Installing bsd.mp 100% |**************************| 10307 KB 00:01 Installing base60.tgz 100% |**************************| 54422 KB 02:09 Extracting etc.tgz 100% |**************************| 186 KB 00:00 Installing comp60.tgz 100% |**************************| 49910 KB 01:50 Installing man60.tgz 100% |**************************| 8617 KB 00:24 Location of sets? (cd0 disk http or 'done') [done] Saving configuration files...done. Making all device nodes...done. Bravo ! Votre installation OpenBSD est un succès ! Ce n’est cependant pas terminé. CONGRATULATIONS! Your OpenBSD install has been successfully completed! To boot the new system, enter 'reboot' at the command prompt. When you login to your new system the first time, please read your mail using the 'mail' command. # Nous devons dorénavant configurer notre carte réseau. cd mnt etc ls mnt etc hostname* cat mnt etc hostname.em0 echo inet 5.39.xx.xx 255.255.255.0 5.39.xx.255 &gt; mnt etc hostname.em0 cat mnt etc hostname.em0 echo 5.39.xx.254 &gt; mnt etc mygate cat mnt etc mygate echo lookup file bind &gt; mnt etc resolv.conf echo nameserver 213.186.33.99 » mnt etc resolv.conf puis activer la gestion multi-coeurs. ls -l mnt bsd* # ls -l mnt bsd* -rw-r--r-- 1 root wheel 10504752 Mar 26 06:42 mnt bsd -rw-r--r-- 1 root wheel 10554411 Mar 26 06:42 mnt bsd.mp -rw-r--r-- 1 root wheel 7905392 Mar 26 06:42 mnt bsd.rd mv mnt bsd mnt bsd.sp cp mnt bsd.mp mnt bsd Puis terminons par un halt. halt # cd mnt etc # ls mnt etc hostname* hostname.em0 # cat mnt etc hostname.em0 dhcp # echo inet 5.39.xx.xx 255.255.255.0 5.39.83.255 &gt; mnt etc hostname.em0 # cat mnt etc hostname.em0 inet 5.39.xx.xx 255.255.255.0 5.39.xx.255 # echo 5.39.83.254 &gt; mnt etc mygate # cat mnt etc mygate 5.39.xx.254 # echo lookup file bind &gt; mnt etc resolv.conf # echo nameserver 213.186.33.99 &gt;&gt; mnt etc resolv.conf # mv mnt bsd mnt bsd.sp # cp mnt bsd.mp mnt bsd # halt syncing disks... done The operating system has halted. Please press any key to reboot. A présent, il nous faut nous rendre une fois de plus sur notre interface Kimsufi et spécifier un démarrage sur le disque-dur puis effectuer à nouveau un redémarrage à froid de notre serveur. Une fois celui-ci redémarré, connectons-nous une fois de plus à celui-ci en SSH à l’aide de notre fidèle compagnon PuTTY mais cette fois-ci avec l’utilisateur que nous avons spécifié plus haut. login as: username username@5.39.xx.xx's password: OpenBSD 6.0 (GENERIC) #2148: Tue Jul 26 12:55:20 MDT 2016 Welcome to OpenBSD: The proactively secure Unix-like operating system. Please use the sendbug(1) utility to report bugs in the system. Before reporting a bug, please try to reproduce it with the latest version of the code. With bug reports, please try to ensure that enough information to reproduce the problem is enclosed, and if a known fix for it exists, include that as well. $ Ressource(s) blog.meseira.net ozgur.kazancci.com nipil.org"
					}

					
				
			
		
			
				
					,
					

					"torrent-installer-et-configurer-transmission": {
						"id": "torrent-installer-et-configurer-transmission",
						"title": "Installer et configurer Transmission",
						"category": "",
						"url": " /torrent/installer_et_configurer_transmission/",
						"content": "Introduction Transmission est un client Bitorrent qui se veut rapide, simple et gratuit. Il embarque de base une interface web qui permet une gestion conviviale. Site officiel : https: transmissionbt.com Installation Pour installer Transmission, rien de plus simple. pkg_add -i transmission Lors de l’installation, l’utilisateur _transmission est créé. Configuration Dans cet exemple, Transmission sera utilisé avec Plex. Pour éviter que Plex n’indexe les fichiers dont le téléchargement n’est pas terminé, il faudra les séparer. Pour cela, il faudra créer un répertoire Incomplete et lui attribuer les bons droits. mkdir var transmission Incomplete chown -R _transmission:_transmission var transmission Incomplete Le fichier de configuration à modifier est var transmission .config transmission-daemon settings.json. Paramètre Valeur rpc-enabled Active l’interface Web rpc-port Port de connexion à l’interface Web rpc-username nom d’utilisateur rpc-password mot de passe rpc-authentication-required Active l’authentification de l’interface Web rpc-whitelist Limite l’accès à l’interface web aux adresses IP spécifié rpc-whitelist-enabled Active la limite d’accès à l’interface Web download-dir Répertoire de téléchargement incomplete-dir Répertoire ou seront stocké les fichiers en cours de téléchargement incomplete-dir-enabled Active le répertoire temporaire Peer port Port de téléchargement dht-enabled A désactiver pex-enabled A désactiver nano var transmission .config transmission-daemon settings.json { \"alt-speed-down\": 50, \"alt-speed-enabled\": false, \"alt-speed-time-begin\": 540, \"alt-speed-time-day\": 127, \"alt-speed-time-enabled\": false, \"alt-speed-time-end\": 1020, \"alt-speed-up\": 50, \"bind-address-ipv4\": \"0.0.0.0\", \"bind-address-ipv6\": \"::\", \"blocklist-enabled\": false, \"blocklist-url\": \"\", \"cache-size-mb\": 4, \"dht-enabled\": true, \"download-dir\": \" var transmission Downloads\", Dossier de destination des téléchargements. \"download-queue-enabled\": true, \"download-queue-size\": 5, \"encryption\": 1, \"idle-seeding-limit\": 30, \"idle-seeding-limit-enabled\": false, \"incomplète-dir\": \" var transmission Incomplete\", Dossier qui contiendra les téléchargements en cours. \"incomplete-dir-enabled\": true, Active l'option \"incomplète-dir\". \"lpd-enabled\": false, \"message-level\": 2, \"peer-congestion-algorithm\": \"\", \"peer-id-ttl-hours\": 6, \"peer-limit-global\": 200, \"peer-limit-per-torrent\": 50, \"peer-port\": 51413, Le port à ouvrir pour permettre à Transmission d'accéder à Internet. \"peer-port-random-high\": 65535, \"peer-port-random-low\": 49152, \"peer-port-random-on-start\": false, \"peer-socket-tos\": \"default\", \"pex-enabled\": true, \"port-forwarding-enabled\": true, \"preallocation\": 1, \"prefetch-enabled\": true, \"queue-stalled-enabled\": true, \"queue-stalled-minutes\": 30, \"ratio-limit\": 2, \"ratio-limit-enabled\": false, \"rename-partial-files\": true, \"rpc-authentication-required\": false, \"rpc-bind-address\": \"0.0.0.0\", \"rpc-enabled\": true, \"rpc-password\": \"Mot_de_passe\", Le mot de passe de connexion (qui sera crypté au redémarrage de Transmission). \"rpc-port\": 9091, Le port qui permet d'établir la connexion à Transmission. \"rpc-url\": \" transmission \", \"rpc-username\": \"transmission\", Le nom d'utilisateur pour la connexion. \"rpc-whitelist\": \"127.0.0.1,192.168.1.*\", Important : Les adresses IP autorisées à se connecter à l'itnerface web. \"rpc-whitelist-enabled\": true, Cette option active la liste des adresses IP autorisées. \"scrape-paused-torrents-enabled\": true, \"script-torrent-done-enabled\": false, \"script-torrent-done-filename\": \"\", \"seed-queue-enabled\": false, \"seed-queue-size\": 10, \"speed-limit-down\": 100, \"speed-limit-down-enabled\": false, \"speed-limit-up\": 100, \"speed-limit-up-enabled\": false, \"start-added-torrents\": true, \"trash-original-torrent-files\": false, \"umask\": 18, \"upload-slots-per-torrent\": 14, \"utp-enabled\": true } Premier démarrage Pour exécuter Transmission au démarrage du système, il suffit d’exécuter la commande suivante. rcctl enable transmission_daemon Et pour démarrer Transmission manuellement. rcctl start transmission_daemon Ensuite, il suffit de se connecter à l’interface web de Transmission. http: votre_serveur:9091 Attention, il faut absolument se connecter depuis une adresse IP autorisée ! L’adresse IP ou la plage réseau a été définie dans le fichier de configuration. De même que si le port par défaut d’accès à l’interface à été modifié, il faudra le prendre en considération. Ne pas oublier non plus d’ouvrir le port de téléchargement (par défaut 51413) sur votre routeur ou parefeu."
					}

					
				
			
		
			
				
					,
					

					"web-creer-une-base-de-donnees-sql-avec-mariadb": {
						"id": "web-creer-une-base-de-donnees-sql-avec-mariadb",
						"title": "Créer une base de données SQL avec MariaDB",
						"category": "",
						"url": " /web/creer_une_base_de_donnees_sql_avec_mariadb/",
						"content": "pkg_add -i mariadb-server # pkg_add -i mariadb-server quirks-2.241 signed on 2016-07-26T16:56:10Z mariadb-server-10.0.25p0v1:mariadb-client-10.0.25v1: ok mariadb-server-10.0.25p0v1:p5-FreezeThaw-0.5001: ok mariadb-server-10.0.25p0v1:p5-MLDBM-2.05: ok mariadb-server-10.0.25p0v1:p5-Net-Daemon-0.48p0: ok mariadb-server-10.0.25p0v1:p5-PlRPC-0.2020: ok mariadb-server-10.0.25p0v1:p5-Math-Base-Convert-0.08: ok mariadb-server-10.0.25p0v1:p5-Params-Util-1.07p1: ok mariadb-server-10.0.25p0v1:p5-Module-Runtime-0.014: ok mariadb-server-10.0.25p0v1:p5-Clone-0.38: ok mariadb-server-10.0.25p0v1:p5-SQL-Statement-1.407: ok mariadb-server-10.0.25p0v1:p5-DBI-1.633: ok mariadb-server-10.0.25p0v1:p5-DBD-mysql-4.033: ok mariadb-server-10.0.25p0v1: ok The following new rcscripts were installed: etc rc.d mysqld See rcctl(8) for details. Look in usr local share doc pkg-readmes for extra documentation. pkg_add -i php-pdo_mysql pkg_add -i php-mysql usr local bin mysql_install_db # usr local bin mysql_install_db WARNING: The host 'OpenBSD.my.domain' could not be looked up with resolveip. This probably means that your libc libraries are not 100 % compatible with this binary MariaDB version. The MariaDB daemon, mysqld, should work normally with the exception that host name resolving will not work. This means that you should use IP addresses instead of hostnames when specifying MariaDB privileges ! Installing MariaDB MySQL system tables in ' var mysql' ... 170405 19:47:41 [Note] usr local libexec mysqld (mysqld 10.0.25-MariaDB) starting as process 60298 ... 170405 19:47:41 [Note] InnoDB: Using mutexes to ref count buffer pool pages 170405 19:47:41 [Note] InnoDB: The InnoDB memory heap is disabled 170405 19:47:41 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins 170405 19:47:41 [Note] InnoDB: Memory barrier is not used 170405 19:47:41 [Note] InnoDB: Compressed tables use zlib 1.2.3 170405 19:47:41 [Note] InnoDB: Not using CPU crc32 instructions 170405 19:47:41 [Note] InnoDB: Initializing buffer pool, size = 128.0M 170405 19:47:41 [Note] InnoDB: Completed initialization of buffer pool 170405 19:47:41 [Note] InnoDB: The first specified data file . ibdata1 did not exist: a new database to be created! 170405 19:47:41 [Note] InnoDB: Setting file . ibdata1 size to 12 MB 170405 19:47:41 [Note] InnoDB: Database physically writes the file full: wait... 170405 19:47:41 [Note] InnoDB: Setting log file . ib_logfile101 size to 48 MB 170405 19:47:42 [Note] InnoDB: Setting log file . ib_logfile1 size to 48 MB 170405 19:47:42 [Note] InnoDB: Renaming log file . ib_logfile101 to . ib_logfile0 170405 19:47:42 [Warning] InnoDB: New log files created, LSN=45781 170405 19:47:42 [Note] InnoDB: Doublewrite buffer not found: creating new 170405 19:47:42 [Note] InnoDB: Doublewrite buffer created 170405 19:47:42 [Note] InnoDB: 128 rollback segment(s) are active. 170405 19:47:42 [Warning] InnoDB: Creating foreign key constraint system tables. 170405 19:47:42 [Note] InnoDB: Foreign key constraint system tables created 170405 19:47:42 [Note] InnoDB: Creating tablespace and datafile system tables. 170405 19:47:42 [Note] InnoDB: Tablespace and datafile system tables created. 170405 19:47:42 [Note] InnoDB: Waiting for purge to start 170405 19:47:43 [Note] InnoDB: Percona XtraDB (http: www.percona.com) 5.6.29-76.2 started; log sequence number 0 170405 19:47:43 [Warning] Failed to load slave replication state from table mysql.gtid_slave_pos: 1146: Table 'mysql.gtid_slave_pos' doesn't exist 170405 19:47:43 [Note] InnoDB: FTS optimize thread exiting. 170405 19:47:43 [Note] InnoDB: Starting shutdown... 170405 19:47:45 [Note] InnoDB: Shutdown completed; log sequence number 1616697 OK Filling help tables... 170405 19:47:45 [Note] usr local libexec mysqld (mysqld 10.0.25-MariaDB) starting as process 52316 ... 170405 19:47:45 [Note] InnoDB: Using mutexes to ref count buffer pool pages 170405 19:47:45 [Note] InnoDB: The InnoDB memory heap is disabled 170405 19:47:45 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins 170405 19:47:45 [Note] InnoDB: Memory barrier is not used 170405 19:47:45 [Note] InnoDB: Compressed tables use zlib 1.2.3 170405 19:47:45 [Note] InnoDB: Not using CPU crc32 instructions 170405 19:47:45 [Note] InnoDB: Initializing buffer pool, size = 128.0M 170405 19:47:45 [Note] InnoDB: Completed initialization of buffer pool 170405 19:47:45 [Note] InnoDB: Highest supported file format is Barracuda. 170405 19:47:45 [Note] InnoDB: 128 rollback segment(s) are active. 170405 19:47:45 [Note] InnoDB: Waiting for purge to start 170405 19:47:45 [Note] InnoDB: Percona XtraDB (http: www.percona.com) 5.6.29-76.2 started; log sequence number 1616697 170405 19:47:46 [Note] InnoDB: FTS optimize thread exiting. 170405 19:47:46 [Note] InnoDB: Starting shutdown... 170405 19:47:47 [Note] InnoDB: Shutdown completed; log sequence number 1616707 OK PLEASE REMEMBER TO SET A PASSWORD FOR THE MariaDB root USER ! To do so, start the server, then issue the following commands: ' usr local bin mysqladmin' -u root password 'new-password' ' usr local bin mysqladmin' -u root -h OpenBSD.my.domain password 'new-password' Alternatively you can run: ' usr local bin mysql_secure_installation' which will also give you the option of removing the test databases and anonymous user created by default. This is strongly recommended for production servers. See the MariaDB Knowledgebase at http: mariadb.com kb or the MySQL manual for more instructions. You can start the MariaDB daemon with: etc rc.d mysqld start Please report any problems at http: mariadb.org jira The latest information about MariaDB is available at http: mariadb.org . You can find additional information about the MySQL part at: http: dev.mysql.com Support MariaDB development by buying support new features from MariaDB Corporation Ab. You can contact us about this at sales@mariadb.com. Alternatively consider joining our community based development effort: http: mariadb.com kb en contributing-to-the-mariadb-project nano etc login.conf mysqld:\\ :openfiles-cur=1024:\\ :openfiles-max=2048:\\ :tc=daemon: [ -f etc login.conf.db ] &amp;&amp; cap_mkdb etc login.conf rcctl enable mysqld rcctl start mysqld usr local bin mysql_secure_installation PS : Le mot de passe par défaut est vide. Donc il suffit de valider en appuyant sur la touche Entrée lorsque le script demandera le mot de passe root actuel. # usr local bin mysql_secure_installation NOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB SERVERS IN PRODUCTION USE! PLEASE READ EACH STEP CAREFULLY! In order to log into MariaDB to secure it, we'll need the current password for the root user. If you've just installed MariaDB, and you haven't set the root password yet, the password will be blank, so you should just press enter here. Enter current password for root (enter for none): OK, successfully used password, moving on... Setting the root password ensures that nobody can log into the MariaDB root user without the proper authorisation. Set root password? [Y n] New password: Re-enter new password: Password updated successfully! Reloading privilege tables.. ... Success! By default, a MariaDB installation has an anonymous user, allowing anyone to log into MariaDB without having to have a user account created for them. This is intended only for testing, and to make the installation go a bit smoother. You should remove them before moving into a production environment. Remove anonymous users? [Y n] ... Success! Normally, root should only be allowed to connect from 'localhost'. This ensures that someone cannot guess at the root password from the network. Disallow root login remotely? [Y n] ... Success! By default, MariaDB comes with a database named 'test' that anyone can access. This is also intended only for testing, and should be removed before moving into a production environment. Remove test database and access to it? [Y n] - Dropping test database... ... Success! - Removing privileges on test database... ... Success! Reloading the privilege tables will ensure that all changes made so far will take effect immediately. Reload privilege tables now? [Y n] ... Success! Cleaning up... All done! If you've completed all of the above steps, your MariaDB installation should now be secure. Thanks for using MariaDB! install -d -m 0711 -o _mysql -g _mysql var www var run mysql nano etc my.cnf [client] socket = var www var run mysql mysql.sock [mysqld] socket = var www var run mysql mysql.sock rcctl restart mysqld A présent créons notre première base de données. mysql -u root -p # mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 3 Server version: 10.0.25-MariaDB OpenBSD port: mariadb-server-10.0.25p0v1 Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others. Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement. MariaDB [(none)]&gt; CREATE DATABASE nextcloud; CREATE USER ‘nextcloud’@’localhost’ IDENTIFIED BY ‘votremotdepasse’; GRANT ALL PRIVILEGES ON nextcloud.* TO ‘nextcloud’@’localhost’;"
					}

					
				
			
		
			
				
					,
					

					"web-installer-et-configurer-un-serveur-http-ssl-et-php": {
						"id": "web-installer-et-configurer-un-serveur-http-ssl-et-php",
						"title": "Installer et configurer un serveur HTTP + SSL et PHP",
						"category": "",
						"url": " /web/installer_et_configurer_un_serveur_http_ssl_et_php/",
						"content": "De base, OpenBSD embarque HTTPD en tant que serveur web et SQLite comme serveur de base de données. Nous allons donc procéder à l’installation de PHP 7. pkg_add -i php-7.0.8p0 # pkg_add -i php-7.0.8p0 quirks-2.241 signed on 2016-07-26T16:56:10Z php-7.0.8p0:xz-5.2.2p0: ok php-7.0.8p0:libxml-2.9.3: ok php-7.0.8p0:femail-1.0p1: ok php-7.0.8p0:femail-chroot-1.0p2: ok php-7.0.8p0: ok The following new rcscripts were installed: etc rc.d php70_fpm See rcctl(8) for details. Look in usr local share doc pkg-readmes for extra documentation. Puis nous l’activons et le démarrons. rcctl enable php70_fpm rcctl start php70_fpm Nous allons commencer copier un exemple de fichier de configuration. cp etc examples httpd.conf etc httpd.conf Puis nous le modifions selon nos besoins. nano etc httpd.conf # $OpenBSD: httpd.conf,v 1.14 2015 02 04 08:39:35 florian Exp $ # # Macros # ext_addr=\"*\" # # Global Options # # prefork 3 # # Servers # server \"cloud.votredomaine.fr\" { listen on $ext_addr port 80 root \" htdocs cloud \" directory index index.php location \" *.php*\" { fastcgi socket \" run php-fpm.sock\" } } # Include MIME types instead of the built-in ones types { include \" usr share misc mime.types\" } # Ensuite, on vérifie que la configuration est OK. httpd -n # httpd -n configuration OK Nous devons bien entendu créer le répertoire var www htdocs cloud au vue de la configuration ci-dessus. mkdir var www htdocs cloud N’oublions pas non plus de créer un fichier index.php afin que par la suite nous puissions générer notre certificat SSL. nano var www htdocs cloud index.php &lt;?php echo(\"test\"); ?&gt; Et attribuer ce dossier à son propriétaire. chown -R www:daemon var www htdocs cloud Nous pouvons à présent activer et démarrer le service httpd. rcctl enable httpd rcctl start httpd Nous installons ensuite certbot afin de générer un certificat SSL. pkg_add -i certbot # pkg_add -i certbot quirks-2.241 signed on 2016-07-26T16:56:10Z certbot-0.8.1:dialog-1.2.20150920p0: ok certbot-0.8.1:libffi-3.2.1p2: ok certbot-0.8.1:python-2.7.12: ok certbot-0.8.1:py-python2-pythondialog-3.3.0p0: ok certbot-0.8.1:py-setuptools-18.2p0v0: ok certbot-0.8.1:py-psutil-4.1.0: ok certbot-0.8.1:py-asn1-0.1.9p0v0: ok certbot-0.8.1:py-idna-2.1: ok certbot-0.8.1:py-ipaddress-1.0.16: ok certbot-0.8.1:py-cparser-2.10p1: ok certbot-0.8.1:py-cffi-1.4.2: ok certbot-0.8.1:py-enum34-1.1.6: ok certbot-0.8.1:py-six-1.10.0: ok certbot-0.8.1:py-cryptography-1.4: ok certbot-0.8.1:py-openssl-0.15.1p1: ok certbot-0.8.1:py-ndg-httpsclient-0.4.0p0: ok certbot-0.8.1:py-werkzeug-0.11.10: ok certbot-0.8.1:py-tz-2016.4: ok certbot-0.8.1:py-pyRFC3339-1.0p0: ok certbot-0.8.1:py-requests-2.10.0: ok certbot-0.8.1:py-acme-0.8.1: ok certbot-0.8.1:py-ConfigArgParse-0.10.0p0: ok certbot-0.8.1:py-parsedatetime-2.1: ok certbot-0.8.1:py-configobj-5.0.6p0: ok certbot-0.8.1:py-zopeevent-4.1.0p0: ok certbot-0.8.1:py-zopeinterface-4.1.3p0: ok certbot-0.8.1:py-pbr-1.8.1: ok certbot-0.8.1:py-funcsigs-1.0.2: ok certbot-0.8.1:py-mock-2.0.0: ok certbot-0.8.1:py-zopecomponent-4.2.2p0: ok certbot-0.8.1: ok --- +python-2.7.12 ------------------- If you want to use this package as your default system python, as root create symbolic links like so (overwriting any previous default): ln -sf usr local bin python2.7 usr local bin python ln -sf usr local bin python2.7-2to3 usr local bin 2to3 ln -sf usr local bin python2.7-config usr local bin python-config ln -sf usr local bin pydoc2.7 usr local bin pydoc Nous avons les outils pour générer notre premier certificat. certbot certonly –webroot –rsa-key-size 4096 -w var www htdocs cloud -d cloud.votredomaine.fr # certbot certonly --webroot --rsa-key-size 4096 -w var www htdocs cloud -d cloud.votredomaine.fr IMPORTANT NOTES: - Congratulations! Your certificate and chain have been saved at etc letsencrypt live cloud.votredomaine.fr fullchain.pem. Your cert will expire on 2017-07-04. To obtain a new or tweaked version of this certificate in the future, simply run certbot again. To non-interactively renew *all* of your certificates, run \"certbot renew\" - If you like Certbot, please consider supporting our work by: Donating to ISRG Let's Encrypt: https: letsencrypt.org donate Donating to EFF: https: eff.org donate-le Nous arrêtons notre service httpd pour pouvoir modifier notre fichier de configuration. rcctl stop httpd Et on modifie le fichier de configuration de HTTPD. nano etc httpd.conf # $OpenBSD: httpd.conf,v 1.14 2015 02 04 08:39:35 florian Exp $ # # Macros # ext_addr=\"*\" # # Global Options # # prefork 3 # # Servers # server \"cloud.votredomaine.fr\" { listen on * port 80 block return 301 \"https: $SERVER_NAME$REQUEST_URI\" } server \"cloud.votredomaine.fr\" { listen on $ext_addr tls port 443 root \" htdocs nextcloud \" directory index index.php tls { key \" etc letsencrypt live cloud.votredomaine.fr privkey.pem\" certificate \" etc letsencrypt live cloud.votredomaine.fr fullchain.pem\" } hsts location \" *.php*\" { fastcgi socket \" run php-fpm.sock\" } } # Include MIME types instead of the built-in ones types { include \" usr share misc mime.types\" } Au vue des modifications, une petite vérification de configuration s’impose ! httpd -n Si tout est ok, nous pouvons relancer notre service httpd. rcctl start httpd Et voilà, le tour est joué !"
					}

					
				
			
		
			
				
					,
					

					"web-installer-nextcloud-11": {
						"id": "web-installer-nextcloud-11",
						"title": "Installer NextCloud 11",
						"category": "",
						"url": " /web/installer_nextcloud_11/",
						"content": "Pour commencer, nous avons besoin de l’outil wget pour télécharger l’archive NextCloud. Commençons donc par l’installer. pkg_add -i wget # pkg_add -i wget quirks-2.241 signed on 2016-07-26T16:56:10Z wget-1.18:pcre-8.38p0: ok wget-1.18:libunistring-0.9.6p0: ok wget-1.18:libpsl-0.13.0: ok wget-1.18: ok Puis, téléchargeons l’archive NextCloud. wget https: download.nextcloud.com server releases nextcloud-11.0.2.tar.bz2 # wget https: download.nextcloud.com server releases nextcloud-11.0.2.tar.bz2 --2017-04-05 19:36:10-- https: download.nextcloud.com server releases nextcloud-11.0.2.tar.bz2 Resolving download.nextcloud.com (download.nextcloud.com)... 88.198.160.133 Connecting to download.nextcloud.com (download.nextcloud.com)|88.198.160.133|:443... connected. HTTP request sent, awaiting response... 200 OK Length: 38598274 (37M) [application x-bzip2] Saving to: 'nextcloud-11.0.2.tar.bz2' nextcloud-11.0.2.tar.bz2 100%[=============================================&gt;] 36.81M 9.37MB s in 5.4s 2017-04-05 19:36:16 (6.88 MB s) - 'nextcloud-11.0.2.tar.bz2' saved [38598274 38598274] Puis nous devons la désarchiver. tar xfvj nextcloud-11.0.2.tar.bz2 Ensuite, nous déplaçons le dossier nextcloud à l’espace prévu par notre serveur web. mv nextcloud var www htdocs Puis nous changeons les permissions sur ce dossier. chown -R www:daemon var www htdocs nextcloud Pour fonctionner, NextCloud a besoin de certaines dépendances PHP. Nous allons donc procéder à leur installation. pkg_add -i php-zip php-gd php-curl php-intl php-bz2 pecl-redis icu4c # pkg_add -i php-zip-7.0.8p0 php-gd-7.0.8p0 php-curl-7.0.8p0 quirks-2.241 signed on 2016-07-26T16:56:10Z php-zip-7.0.8p0: ok php-gd-7.0.8p0:png-1.6.23: ok php-gd-7.0.8p0:jpeg-1.5.0p0v0: ok Can't install php-gd-7.0.8p0 because of libraries |library X11.16.1 not found | not found anywhere |library Xpm.9.0 not found | not found anywhere |library freetype.25.0 not found | not found anywhere Direct dependencies for php-gd-7.0.8p0 resolve to png-1.6.23 php-7.0.8p0 jpeg-1.5.0p0v0 Full dependency tree is jpeg-1.5.0p0v0 femail-1.0p1 libxml-2.9.3 php-7.0.8p0 xz-5.2.2p0 femail-chroot-1.0p2 gettext-0.19.7 png-1.6.23 libiconv-1.14p3 php-curl-7.0.8p0:nghttp2-1.12.0: ok php-curl-7.0.8p0:curl-7.49.0: ok php-curl-7.0.8p0: ok Problème ! Nous constatons que certaines librairies sont manquantes. Il s’agit des sets X qui n’ont pas été installé lors de l’installation du système d’exploitation. Pour résoudre ce problème se rendre sur cette page. Une fois le set X installé, on peut retenter l’installation de php-gd. pkg_add -i php-gd-7.0.8p0 # pkg_add -i php-gd-7.0.8p0 quirks-2.241 signed on 2016-07-26T16:56:10Z php-gd-7.0.8p0: ok Parfait ! Nous activons ensuite ces extensions. cp etc php-7.0.sample * etc php-7.0 Voici le résultat de cette copie. ls -l etc php-7.0 # ls -l etc php-7.0 total 16 -rw-r--r-- 1 root wheel 18 Mar 26 19:53 curl.ini -rw-r--r-- 1 root wheel 16 Mar 26 19:53 gd.ini -rw-r--r-- 1 root wheel 26 Mar 26 19:53 opcache.ini -rw-r--r-- 1 root wheel 17 Mar 26 19:53 zip.ini Une chose importante avant de continuer mais surtout avant d’utiliser NextCloud… Il faut modifier le fichier de configuration PHP afin de lui signaler que nous voulons augmenter la taille maximale possible des fichiers en upload. nano etc php-7.0.ini Puis nous modifions les lignes post_max_size et upload_max_filesize tel que ci-dessous afin d’augmenter ce volume à 5Go. post_max_size = 5000M upload_max_filesize = 5000M Documentation : https: docs.nextcloud.com server 9 admin_manual configuration_files big_file_upload_configuration.html Puis nous redémarrons le service PHP. rcctl restart php70_fpm # rcctl restart php70_fpm php70_fpm(ok) php70_fpm(ok) Enfin, nous modifions le fichier de configuration du serveur httpd pour lui spécifier que notre cloud doit pouvoir accepter des upload à hauteur de 513Mb maximum. nano etc httpd.conf server \"cloud.votredomaine.fr\" { listen on * port 80 block return 301 \"https: $SERVER_NAME$REQUEST_URI\" } server \"cloud.votredomaine.fr\" { listen on $ext_addr tls port 443 root \" htdocs nextcloud \" directory index index.php tls { key \" etc letsencrypt live cloud.votredomaine.fr privkey.pem\" certificate \" etc letsencrypt live cloud.votredomaine.fr fullchain.pem\" } hsts # Set max upload size to 513M (in bytes) connection max request body 537919488 # First deny access to the specified files location \" db_structure.xml\" { block } location \" .ht*\" { block } location \" README\" { block } location \" data*\" { block } location \" config*\" { block } location \" *.php*\" { fastcgi socket \" run php-fpm.sock\" } } On vérifie la configuration, on al recharge et enfin on redémarre. httpd -n rcctl reload httpd rcctl restart httpd Rendons-nous ensuite à l’adresse de notre serveur pour la configuration de NextCloud. http: cloud.votredomaine.fr"
					}

					
				
			
		
			
				
					,
					

					"web-utiliser-relayd-en-tant-que-reverse-proxy": {
						"id": "web-utiliser-relayd-en-tant-que-reverse-proxy",
						"title": "Utiliser relayd en tant que Reverse Proxy",
						"category": "",
						"url": " /web/utiliser_relayd_en_tant_que_reverse_proxy/",
						"content": "Un serveur principal qui héberge plusieurs VM sur lesquels un service web tourne. Dans OpenBSD, relayd permet entre autre de pouvoir rediriger le flux au bon endroit. nano etc relayd.conf table &lt;cloud&gt; { 10.99.0.4 } table &lt;torrent&gt; { 10.99.0.1 } table &lt;plex&gt; { 10.99.0.2 } http protocol \"votredomaine\" { match request quick header \"Host\" value \"cloud.votredomaine.fr\" forward to &lt;cloud&gt; match request quick header \"Host\" value \"torrent.votredomaine\" forward to &lt;torrent&gt; match request quick header \"Host\" value \"plex.votredomaine.fr\" forward to &lt;plex&gt; } relay \"plex\" { listen on 10.99.0.3 port 80 protocol \"votredomaine\" forward to &lt;plex&gt; port 32400 } relay \"cloud\" { listen on 10.99.0.3 port 80 protocol \"votredomaine\" forward to &lt;cloud&gt; port 80 } relay \"torrent\" { listen on 10.99.0.3 port 80 protocol \"votredomaine\" forward to &lt;torrent&gt; port 80 } Vérifier que la configuration ne comporte pas d’erreur. relayd -n Puis recharger la configure et ou redémarrer le service. rcctl reload relayd rcctl restart relayd Documentation : http: man.openbsd.org relayd.8 Documentation : http: man.openbsd.org cgi-bin man.cgi OpenBSD-current man5 relayd.conf"
					}

					
				
			
		
	};
</script>
<script src="/scripts/lunr.min.js"></script>
<script src="/scripts/search.js"></script>

			</article>
		</section>

		<script>
			document.getElementById("open-nav").addEventListener("click", function () {
				document.body.classList.toggle("nav-open");
			});
		</script>
	</body>
</html>
